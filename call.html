<!DOCTYPE html>
<html lang="ru" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Дедушка Мороз</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" charset="utf-8"></script>
    <script src="/jquery.fullscreen-min.js" charset="utf-8"></script>
  </head>
  <body>
    <style media="screen">
      body{
        margin:0px;
        background-color: black;
      }
      .camera{
        position: absolute;
        left: 76%;
        top: 65%;
        z-index:2;
      }
      .moroz{
        position: fixed;
      }
    </style>
    <div class="call">
      <div class="camera">
          <video id="video" style="border-radius:90px">Video stream not available.</video>
          <audio id="audio" src="reconnect.mp3"></audio>
      </div>
      <div class="moroz">
        <video id="moroz" src="nikita.mp4" width="100%"></video>
      </div>
    </div>

    <script>
      (function() {
        $(document).fullScreen();
      // The width and height of the captured photo. We will set the
      // width to the value defined here, but the height will be
      // calculated based on the aspect ratio of the input stream.

      var width = 320;    // We will scale the photo width to this
      var height = 0;     // This will be computed based on the input stream

      // |streaming| indicates whether or not we're currently streaming
      // video from the camera. Obviously, we start at false.

      var streaming = false;

      // The various HTML elements we need to configure or control. These
      // will be set by the startup() function.

      var video = null;

      function startup() {
        video = document.getElementById('video');
        canvas = document.getElementById('canvas');
        $(document).fullScreen(true);

        navigator.mediaDevices.getUserMedia({video: true, audio: false})
        .then(function(stream) {
          video.srcObject = stream;
          setTimeout(function(){
            document.getElementById('audio').play();
            video.play();
          },37800)
          document.getElementById('moroz').play();
        })
        .catch(function(err) {
          console.log("An error occurred: " + err);
        });

        video.addEventListener('canplay', function(ev){
          if (!streaming) {
            height = video.videoHeight / (video.videoWidth/width);

            // Firefox currently has a bug where the height can't be read from
            // the video, so we will make assumptions if this happens.

            if (isNaN(height)) {
              height = width / (4/3);
            }

            video.setAttribute('width', width);
            video.setAttribute('height', height);
            streaming = true;
          }
        }, false);
      }
      window.addEventListener('load', startup, false);
      $('video#moroz').on('ended',function() {
        document.exitFullscreen();
        location.href = 'end.html';
      });
    })();
    </script>
  </body>
</html>
